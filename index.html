<!DOCTYPE html>
<html>
  <style>
    body{
      width: 100%;
    }
    button{
      font-size: 20px;
    }
    video{
      width: 90vw;
    }
  </style>
<body>
<div>
  <h1>My First Heading</h1>
  <p>My first paragraph.</p>
</div>
<div>
  <video></video>
</div>
<div>
  <button id="permissions">Permissions</button>
  <button id="notification">Notification</button>
  <button id="camera">Camera</button>
  <button id="vibrate">Vibrate</button>
</div>
<div>
  <p id="log"></p>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function(){
    var btnPermissions = document.querySelector('#permissions');
    var btnNotification = document.querySelector('#notification');
    var btnCamera = document.querySelector('#camera');
    var btnVibrate = document.querySelector('#vibrate');
    var pLog = document.querySelector('p#log');

    var getAllPermissions = async () => {
      try {
        var status = await navigator.permissions;
        console.log('status', status);
        pLog.innerHTML = status?.state;
      } catch (error) {
        console.error('error', error);
        pLog.innerHTML = JSON.stringify(error);
      }
    };

    var getPermission = async (permissonName) => {
      try {
        var status = await navigator.permissions.query({ name: permissonName });
        console.log('status', status);
        pLog.innerHTML = status?.state;
        status.onchange = () => {
          console.log('${permissonName} permission state has changed to ', this.state);
        };
      } catch (error) {
        console.error('error', error);
        pLog.innerHTML = JSON.stringify(error);
      }
    };

    var handlerPermissions = (event) => {
      event.preventDefault();
      getAllPermissions();
    };

    var handlerNotificationPermission = (event) => {
      event.preventDefault();
      getPermission('notifications');
    };

    var handlerVibrate = (event) => {
      event.preventDefault();
      try{
        window.navigator.vibrate([200, 100, 200]);
      } catch (error) {
        console.error('error', error);
        pLog.innerHTML = JSON.stringify(error);
      }
    };

    var handlerCameraPermission = (event) => {
      event.preventDefault();
      getPermission('camera');
      var test = navigator.getUserMedia({ audio: false, video: true },
      function(stream) {
         var video = document.querySelector('video');
         video.srcObject = stream;
         video.onloadedmetadata = function(e) {
           video.play();
         };
      },
      function(err) {
         console.log("The following error occurred: " + err.name);
         pLog.innerHTML = JSON.stringify(err.name);
      });
      consool.log(test);
    };

    btnPermissions.addEventListener('click', handlerPermissions);
    btnNotification.addEventListener('click', handlerNotificationPermission);
    btnCamera.addEventListener('click', handlerCameraPermission);
    btnVibrate.addEventListener('click', handlerVibrate);
  });
</script>
</body>
</html>
